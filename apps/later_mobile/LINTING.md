# Flutter Code Style and Linting Guide

This document describes the linting and code style configuration for the `later_mobile` Flutter application.

## Overview

We use an enhanced configuration based on `flutter_lints` with strict analyzer settings and additional lint rules to ensure high code quality, consistency, and maintainability.

## Configuration

### Analyzer Settings

We enable strict type checking to catch potential type-related errors early:

- **strict-casts**: Prevents implicit downcasts that could fail at runtime
- **strict-inference**: Prevents implicit `dynamic` types, requiring explicit type annotations
- **strict-raw-types**: Prevents use of generic types without type parameters

### Error Severity

The following violations are treated as **errors** rather than warnings:

- `unused_import` - Unused imports clutter the code
- `unused_local_variable` - Indicates dead code or logic errors
- `dead_code` - Code that will never execute
- `missing_required_param` - Missing required parameters
- `missing_return` - Functions missing return statements

## Enabled Lint Rules

### Style Rules

These rules enforce consistent code style:

- `prefer_single_quotes` - Use single quotes for strings (e.g., `'hello'` not `"hello"`)
- `prefer_const_constructors` - Use const constructors when possible for performance
- `prefer_const_constructors_in_immutables` - Enforce const in immutable classes
- `prefer_const_declarations` - Use `const` instead of `final` for compile-time constants
- `prefer_const_literals_to_create_immutables` - Use const for literal collections
- `prefer_final_fields` - Mark fields as final when they're not reassigned
- `prefer_final_locals` - Mark local variables as final when they're not reassigned
- `prefer_final_in_for_each` - Use final in for-each loops

### Error Prevention Rules

These rules help prevent common bugs:

- `avoid_print` - Use proper logging instead of print statements
- `avoid_unnecessary_containers` - Remove Container widgets that don't add value
- `avoid_web_libraries_in_flutter` - Prevent use of dart:html in Flutter apps
- `no_logic_in_create_state` - Keep createState() simple
- `sized_box_for_whitespace` - Use SizedBox instead of Container for spacing
- `use_key_in_widget_constructors` - Add keys to widget constructors for better performance
- `use_build_context_synchronously` - Prevent using BuildContext across async gaps

### Code Quality Rules

These rules improve code maintainability:

- `require_trailing_commas` - Add trailing commas for better formatting
- `sort_child_properties_last` - Put child/children parameters last in widget constructors
- `sort_constructors_first` - Put constructors at the top of classes
- `always_declare_return_types` - Explicitly declare function return types
- `annotate_overrides` - Mark overridden methods with @override
- `avoid_redundant_argument_values` - Don't pass default values explicitly
- `avoid_returning_null_for_void` - Void functions should not return null

### Package Management

- `sort_pub_dependencies` - Keep dependencies in pubspec.yaml alphabetically sorted

## Generated Code Exclusions

The following patterns are excluded from analysis:

- `**/*.g.dart` - Code generated by build_runner
- `**/*.freezed.dart` - Code generated by freezed package
- `**/*.mocks.dart` - Mock classes generated for testing

## IDE Integration

### VSCode Setup

VSCode settings are configured in `.vscode/settings.json` to:

- **Format on save** - Automatically format code when saving files
- **Run quick fixes on save** - Auto-fix lint violations when possible
- **80-character line limit** - Show a ruler at 80 characters
- **Dart-specific formatting** - Use the official Dart formatter

To ensure VSCode is properly configured:

1. Install the Dart extension (`Dart-Code.dart-code`)
2. Reload VSCode after installation
3. Open a Dart file and verify the formatter runs on save

### Android Studio Setup (Optional)

1. Open Settings → Languages & Frameworks → Flutter
2. Enable "Format code on save"
3. Navigate to Editor → Code Style → Dart
4. Set line length to 80 characters

## Running Analysis

### Command Line

Check for lint violations:

```bash
flutter analyze
```

Format code:

```bash
dart format .
```

Verify all code is formatted:

```bash
dart format --set-exit-if-changed .
```

Apply automated fixes:

```bash
dart fix --apply
```

### IDE

- **VSCode**: Violations appear as squiggly underlines, hover for details
- **Android Studio**: Violations shown in the Problems panel

## Common Violations and Fixes

### Unused Imports

**Problem**: Import statement not used in the file

**Fix**: Remove the import or use the imported symbol

```dart
// ❌ Bad
import 'package:flutter/material.dart';  // Not used

// ✅ Good
// Remove the import if not needed
```

### Missing Trailing Commas

**Problem**: No trailing comma in widget trees

**Fix**: Add trailing comma after the last parameter

```dart
// ❌ Bad
Container(
  child: Text('Hello')
)

// ✅ Good
Container(
  child: Text('Hello'),
)
```

### Prefer Single Quotes

**Problem**: Using double quotes for strings

**Fix**: Use single quotes unless string contains a single quote

```dart
// ❌ Bad
final name = "Alice";

// ✅ Good
final name = 'Alice';
final message = "It's a beautiful day";  // OK - contains single quote
```

### Prefer Const Constructors

**Problem**: Creating immutable widgets without const

**Fix**: Add const keyword when all arguments are compile-time constants

```dart
// ❌ Bad
Text('Hello')

// ✅ Good
const Text('Hello')
```

### Use BuildContext Synchronously

**Problem**: Using BuildContext after an await in async function

**Fix**: Store values before await or check mounted

```dart
// ❌ Bad
Future<void> loadData() async {
  final data = await fetchData();
  Navigator.of(context).pop();  // context used after async gap
}

// ✅ Good
Future<void> loadData() async {
  final navigator = Navigator.of(context);
  final data = await fetchData();
  navigator.pop();  // using stored navigator
}
```

## Troubleshooting

### Analysis Not Running

- Ensure Flutter SDK is properly installed
- Run `flutter pub get` to fetch dependencies
- Restart your IDE

### Format on Save Not Working

**VSCode**:
- Check that Dart extension is installed and enabled
- Verify `.vscode/settings.json` exists and is properly configured
- Check Output → Dart for error messages

**Android Studio**:
- Verify Flutter plugin is installed
- Check Settings → Languages & Frameworks → Flutter
- Ensure "Format code on save" is checked

### Too Many Violations

When first enabling strict rules, you may see many violations. Fix them in order:

1. Run `dart fix --apply` to auto-fix what's possible
2. Fix errors first (unused imports, dead code)
3. Fix warnings in batches by category
4. Use `// ignore:` comments sparingly for false positives

## Future Improvements

This configuration provides a good balance of strictness and practicality. If the team wants stricter rules in the future, we can:

- Enable `public_member_api_docs` to require documentation
- Migrate to `very_good_analysis` package for 188+ rules
- Add custom lint rules specific to our architecture

## References

- [Dart Linter Rules](https://dart.dev/lints)
- [Flutter Lints Package](https://pub.dev/packages/flutter_lints)
- [Effective Dart](https://dart.dev/guides/language/effective-dart)
- [Flutter Style Guide](https://docs.flutter.dev/development/tools/formatting)
